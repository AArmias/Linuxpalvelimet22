# h6 - DJ Prod

Alla kuudennen kotitehtävän palautus. Tehtävä tehty 4.10.2022 omalla henkilökohtaisella koneellani.

Pääkone:

- Windows 10 Pro 
- 32GB RAM 
- 2TB levytilaa 

Virtuaalikoneen kokoonpano:

- Oracle VirtualBox 6.1.36 
- Ubuntu 22.04.1 
- Apache 2 
- 8192MB RAM 
- 25GB levytilaa

Lisäksi: 

- Pilvipalvelin vuokrattu DigitalOceanista. 
- Nimipalvelu hankittu Name.comista 
- Käytetty apuna Github Educationin etuja ja alennuksia. 

------------------------------------------------------

## a) Tee tuotantotyyppinen asennus Djangosta. ##

### Aloitus ###
Kotitehtävässä h4 hankittiin oma palvelin ja asennettiin tuolle palvelimelle apache, sekä laitettiin se toimimaan. Tätä tehtävää aloittaessa apacahe siis toimii jo valmiiksi omalla palvelimellani. Tuon tehtävän voit katsoa tästä, mikäli tarvitset apua palvelimen hankintaan, käyttöönottoon ja apachen asentamiseen. https://github.com/AArmias/Linuxpalvelimet22/blob/main/h4.md **HUOM! koska tehtävä on harjoitus, tällä kertaa homma kuitenkin tehdään virtuaalikoneella, ei vuokratulla palvelimella!** 

Tämä tehtävä aloitetaan siis kohdasta, jossa meillä on jo toimiva apache. Aluksi päivittää totutusti viimeisimmät paketit ja päivitykset käyttöön: `sudo apt-get update` ja `sudo apt-get upgrade`, sekä lisätä tulevalle sisällölle uusi hakemisto ja luoda hakemistoon index.html kansio: `cd` (varmistetaan sijainti), `mkdir -p publicwsgi/teron/static/ `luodaan **publicwsgi/teron/static/** niminen hakemisto ja sinne käskyllä `"Static toimii jos tämä näkyy."|tee publicwsgi/teron/static/index.html` index.html tiedosto joka pitää sisällään tekstin **"Static toimii jos tämä näkyy."**

![image](https://user-images.githubusercontent.com/102689055/194014855-a9fbc22a-a05f-4ead-b002-782ef8e59d40.png)


Tämän jälkeen luodaan uusi virtuaalihosti apachelle, jotta tuleva webapp saadaan toimimaan. Tämä onnistuu käyskyllä `sudoedit /etc/apache2/sites-available/teron.conf`
Ja editoriin syötetään kuvan mukaisesti tiedot omasta kotihakemistosta.

![image](https://user-images.githubusercontent.com/102689055/194016949-40531000-a97f-457d-8e55-1dec51f5411b.png)



Otetaan hosti käyttöön käskyllä `sudo a2ensite teron.conf`

![image](https://user-images.githubusercontent.com/102689055/194017497-e8b38693-514b-4dce-bb92-d53d135e3114.png)


ja otetaan pois käytöstä **000-default.conf** tiedosto käskyllä `sudo a2dissite 000-default.conf` (mikäli tämä unohtuu, homma ei toimi) 
ja kokeillaan toimivuutta käskyllä: `/sbin/apache2ctl configtest`

Nyt on aika käynnistää apache uudelleen ja tarkistaa, toimiiko tuo static sivu sen jälkeen. 
`sudo systemctl restart apache2` käynnistää apachen uudelleen. 

![image](https://user-images.githubusercontent.com/102689055/194017659-8395ff70-9659-4b48-98c3-0985c6d2cb58.png)



Käskyllä `curl http://localhost/static/` nähdään toimiiko static sivu. 

![image](https://user-images.githubusercontent.com/102689055/194006634-831f141e-c17c-41f7-b458-0bb4ac7f43a0.png)


Sivu toimii! Tästä voidaan todeta, että kaikki ylemänä tehdyt toimempiteet toimivat. Aika mennä eteenpäin! 

-------------------------------------------------------------------------------------------


### VirtualEnv ja Djangon asennus ### 
Seuraavat toimenpiteet käytiin läpi edellisessä tehtävässä, eli palautuksessa h5 (https://github.com/AArmias/Linuxpalvelimet22/blob/main/h5.md).
Tarkemmin toimempiteitä voi katsoa siis linkistä. Käydään toimempiteet kuitenkin tässä lyhyesti: 

Aloitetaan uuden virtuaaliympäristön luomisella aiemmin luodulle publicwsgi hakemistolle ja ladataan sinne pyhtonin paketit:
- `sudo apt-get -y install virtualenv` 

- `cd ja cd publicwsgi/`

- `virtualenv -p python3 --system-site-packages env`

Otetaan ympäristö aktiiviseksi `source env/bin/activate`

![image](https://user-images.githubusercontent.com/102689055/194007830-d011eb25-696d-4792-aa5b-f6325409e4ac.png)

Homma kunnossa tähän asti. 

Mikäli on epävarma olo onko oikea ympäristö käytössä asian voi vielä varmistaa käskyllä: `which pip`

![image](https://user-images.githubusercontent.com/102689055/194008014-c8ccb816-be65-4039-aa08-2f6664e1f602.png)


Oikea ympäristö käytössä, eteenpäin! 

Asennetaan django luomalla requirements.txt tiedosto, joka sisältää sanan django. `micro requirements.txt` ja **django**.
Käynnistetään asennus: `pip install -r requirements.txt`

![image](https://user-images.githubusercontent.com/102689055/194008410-84ae4d9e-07d8-484e-8a06-91962544f0e1.png)

Testataan: `django-admin --version` 

![image](https://user-images.githubusercontent.com/102689055/194008513-d3b80954-a12c-4172-8050-8d1d5e812e96.png)


Toimii! 

--------------------------------------------------------

### Django ###

Aloitetaan uusi projekti, koska teros niminen hakemisto jo löytyy, tehdään projektista "teron" niminen: `django-admin startproject teron`
Pistetään virtuahostin conffi tiedosto kuntoon. `sudoedit /etc/apache2/sites-available/teron.conf`

teron.conf näyttää tältä: 
![image](https://user-images.githubusercontent.com/102689055/194021501-05278026-d938-482e-af28-55a8278920d4.png)

Seuraavaksi asennetaan Apacheen WSGI moduuli komennolla: `sudo apt-get -y install libapache2-mod-wsgi-py3`

![image](https://user-images.githubusercontent.com/102689055/194021377-82ab642d-f6ae-4d63-932b-a4684921cc9b.png)








